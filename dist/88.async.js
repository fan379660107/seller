(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[88],{"Dux/":function(e,t,a){"use strict";var l=a("g09b"),o=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("T2oS");var n=l(a("W9HT"));a("sRBo");var d=l(a("kaz8"));a("giR+");var s=l(a("fyUT"));a("5NDa");var c=l(a("5rEg")),u=l(a("p0pE")),i=l(a("d6i3")),r=l(a("1l/V")),f=l(a("2Taf")),m=l(a("vZ4D")),g=l(a("l4Ni")),_=l(a("ujKo")),p=l(a("rlhR")),v=l(a("MhPg"));a("iQDF");var h=l(a("+eQT"));a("y8nQ");var y,E,L,k,N=l(a("Vl3Y")),C=a("MuoO"),w=o(a("q1tI")),I=a("k82f"),V=a("+n12"),S=a("wGLq"),b=l(a("hh8c")),T=l(a("JMh9")),x=l(a("kUTa")),H=l(a("6qop")),D=l(a("wd/R")),q=N.default.Item,F=h.default.RangePicker,G="",M=(y=(0,C.connect)(function(e){var t=e.promotion,a=e.global;return{promotion:t,global:a}}),E=N.default.create(),y(L=E((k=function(e){function t(e){var a;return(0,f.default)(this,t),a=(0,g.default)(this,(0,_.default)(t).call(this,e)),a.get_detail=function(){var e=(0,r.default)(i.default.mark(function e(t){var l,o,n,d,s;return i.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:l=a.props.dispatch,o=a.state,n=o.detail,d=o.ladder_promotion,s=(0,p.default)(a),l({type:"promotion/get_full_nld_detail",payload:{fullId:t},callback:function(){var e=(0,r.default)(i.default.mark(function e(t){return i.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:200==t.state?(n=t.data,n.ruleList.map(function(e,t){0==t?(d[0].fullValue=e.fullValue,d[0].minusValue=e.minusValue,null!=e.couponList&&void 0!=e.couponList.length&&e.couponList.length>0&&(d[0].sel_voucher=e.couponList[0],d[0].sendCouponIds=!0),null!=e.giftList&&void 0!=e.giftList.length&&e.giftList.length>0&&(d[0].sel_goods=e.giftList[0],d[0].sendGoodsIds=!0)):(d.push({fullValue:e.fullValue,minusValue:e.minusValue,sel_voucher:null!=e.couponList&&void 0!=e.couponList.length&&e.couponList.length>0?e.couponList[0]:{},sendCouponIds:null!=e.couponList&&void 0!=e.couponList.length&&e.couponList.length>0,sel_goods:null!=e.giftList&&void 0!=e.giftList.length&&e.giftList.length>0?e.giftList[0]:{},sendGoodsIds:null!=e.giftList&&void 0!=e.giftList.length&&e.giftList.length>0,key:t+1}),s.key+=1)}),a.setState({detail:n,ladder_promotion:d})):(0,V.failTip)(t.msg);case 1:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleSelectRows=function(e,t){a.setState({selectedRows:e,selectedRowKeys:t})},a.handleSaveAllData=function(){var e=a.props.dispatch,t=a.state,l=t.query,o=t.ladder_promotion,n=t.minusValueMap,d={};a.props.form.validateFieldsAndScroll(function(t,a){if(!t){if(d.fullName=a.fullName,a.activityTime&&(d.startTime=a.activityTime[0]?a.activityTime[0].format(V.dateTimeFormat):"",d.endTime=a.activityTime[1]?a.activityTime[1].format(V.dateTimeFormat):""),Date.parse(d.startTime)>=Date.parse(d.endTime))return(0,V.failTip)("".concat((0,V.sldComLanguage)("\u6d3b\u52a8\u5f00\u59cb\u65f6\u95f4\u5fc5\u987b\u5c0f\u4e8e\u7ed3\u675f\u65f6\u95f4"))),!1;for(var s=[],c=!0,u=0;u<o.length;u++){var i=o[u],r=a["minusValue_".concat(i.key)],f=void 0!=i.sel_goods.goodsId&&i.sel_goods.goodsId>0?i.sel_goods.goodsId:"",m=void 0!=i.sel_voucher.couponId&&i.sel_voucher.couponId>0?i.sel_voucher.couponId:"";if(!m&&!f&&(void 0==r||!r))return(0,V.failTip)("".concat((0,V.sldComLanguage)("\u8bf7\u8bbe\u7f6e")).concat(u+1).concat((0,V.sldComLanguage)("\u7ea7\u4f18\u60e0\u7684\u4f18\u60e0\u5185\u5bb9"))),!1;if(s.push({fullValue:a["fullValue_".concat(i.key)],minusValue:r,sendIntegral:0,sendCouponIds:m,sendGoodsIds:f}),u>0&&s[u].fullValue<s[u-1].fullValue){c=!1,(0,V.failTip)("\u7b2c".concat(n[u],"\u9636\u68af\u7684\u4f18\u60e0\u95e8\u69db\u4e0d\u80fd\u4f4e\u4e8e\u7b2c").concat(n[u-1],"\u9636\u68af\u7684\u4f18\u60e0\u95e8\u69db"));break}if(u>0&&s[u].minusValue>s[u-1].minusValue){c=!1,(0,V.failTip)("\u7b2c".concat(n[u],"\u9636\u68af\u7684\u6253\u6298\u529b\u5ea6\u4e0d\u80fd\u4f4e\u4e8e\u7b2c").concat(n[u-1],"\u9636\u68af\u7684\u6253\u6298\u529b\u5ea6"));break}}if(!c)return;d.ruleJson=JSON.stringify(s);var g="";G.setState({loading:!0}),void 0!=l.id&&l.id>0&&"edit"==l.tar?(d.fullId=l.id,g="promotion/edit_full_nld"):g="promotion/add_full_nld",e({type:g,payload:d,callback:function(e){G.setState({loading:!1}),200==e.state?((0,V.sucTip)(e.msg),setTimeout(function(){G.props.history.goBack()},500)):(0,V.failTip)(e.msg)}})}})},a.backPre=function(){a.props.history.goBack()},a.key=1,a.ladder_item={key:1,fullValue:"",minusValue:"",sendCouponIds:!1,sel_voucher:{},sendGoodsIds:!1,sel_goods:{}},a.addPromotion=function(){var e=a.state.ladder_promotion;e.push((0,u.default)({},a.ladder_item,{key:a.key+1})),a.key+=1,a.setState({ladder_promotion:e})},a.handleGoodsOrVoucher=function(e,t,l){if(a.itemKey=l.key,t.target.checked)a.setState({link_type:e,curData:l});else{var o=a.state.ladder_promotion,n=o.filter(function(e){return e.key==l.key})[0];"goods"==e?n.sel_goods={}:"voucher"==e&&(n.sel_voucher={}),a.setState({ladder_promotion:JSON.parse(JSON.stringify(o))})}},a.resetSel=function(e,t){a.setState({link_type:e,curData:t})},a.sldHandleLinkCancle=function(){var e=a.state.link_type;"goods"==e?a.props.form.resetFields(["sendGoodsIds_"+a.itemKey]):"voucher"==e&&a.props.form.resetFields(["sendCouponIds_"+a.itemKey]),a.setState({link_type:""})},a.seleSku=function(e){var t=a.state,l=t.link_type,o=t.curData,n=t.ladder_promotion,d=n.filter(function(e){return e.key==o.key})[0];"goods"==l?d.sel_goods=e:"voucher"==l&&(d.sel_voucher=e),a.setState({link_type:"",ladder_promotion:JSON.parse(JSON.stringify(n)),curData:{}})},a.delPromotion=function(e){var t=a.state.ladder_promotion;t=t.filter(function(t){return t.key!=e}),a.setState({ladder_promotion:JSON.parse(JSON.stringify(t))})},G=(0,p.default)(a),a.state={ladder_promotion:[{key:1,fullValue:"",minusValue:"",sendCouponIds:!1,sel_voucher:{},sendGoodsIds:!1,sel_goods:{}}],curData:{},link_type:"",loading:!1,query:e.location.query,selectedRows:[],selectedRowKeys:[],detail:{},viewFlag:void 0!=e.location.query.tar&&"view"==e.location.query.tar,minusValueMap:["\u4e00","\u4e8c","\u4e09","\u56db","\u4e94"]},a}return(0,v.default)(t,e),(0,m.default)(t,[{key:"componentDidMount",value:function(){var e=this.state.query;void 0!=e.id&&e.id>0&&this.get_detail(e.id),this.props.dispatch({type:"global/getLayoutCollapsed"})}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this,t=this.state,l=t.loading,o=t.ladder_promotion,u=t.link_type,i=t.detail,r=t.viewFlag,f=this.props.form.getFieldDecorator;return w.default.createElement("div",{className:"".concat(T.default.full_activity," ").concat(b.default.common_page," ").concat(b.default.com_flex_column),style:{position:"relative"}},(0,V.sldLlineRtextAddGoodsAddMargin)("#69A2F2","".concat((0,V.sldComLanguage)("\u6ee1N\u4ef6\u6298\u6263\u6d3b\u52a8")),0,0,10),(0,V.getSldHorLine)(1),w.default.createElement(n.default,{spinning:l},w.default.createElement(N.default,{layout:"inline"},w.default.createElement(I.Scrollbars,{autoHeight:!0,autoHeightMin:100,autoHeightMax:document.body.clientHeight-160},w.default.createElement("div",{className:"".concat(b.default.goods_sku_tab," ").concat(b.default.add_goods_wrap)},w.default.createElement("div",null,(0,V.getSldEmptyH)(10),(0,V.sldCommonTitleByBg)("".concat((0,V.sldComLanguage)("\u6d3b\u52a8\u57fa\u672c\u4fe1\u606f"))),w.default.createElement("div",{className:"".concat(T.default.full_acm_activity," ").concat(b.default.flex_column_start_start)},w.default.createElement("div",{className:"".concat(T.default.item," ").concat(b.default.flex_row_start_start)},w.default.createElement("div",{className:"".concat(T.default.left)},w.default.createElement("span",{style:{color:"red"}},"*"),(0,V.sldComLanguage)("\u6d3b\u52a8\u540d\u79f0")),w.default.createElement("div",{className:"".concat(T.default.right)},w.default.createElement(q,{extra:"".concat((0,V.sldComLanguage)("\u6700\u591a\u8f93\u516520\u4e2a\u5b57")),style:{width:300}},f("fullName",{initialValue:i.fullName,rules:[{required:!0,whitespace:!0,message:"".concat((0,V.sldComLanguage)("\u8bf7\u8f93\u5165\u6d3b\u52a8\u540d\u79f0"))}]})(w.default.createElement(c.default,{maxLength:20,disabled:r,style:{width:400},placeholder:"".concat((0,V.sldComLanguage)("\u8bf7\u8f93\u5165\u6d3b\u52a8\u540d\u79f0"))}))))),w.default.createElement("div",{className:"".concat(T.default.item," ").concat(b.default.flex_row_start_start)},w.default.createElement("div",{className:"".concat(T.default.left)},w.default.createElement("span",{style:{color:"red"}},"*"),(0,V.sldComLanguage)("\u6d3b\u52a8\u65f6\u95f4")),w.default.createElement("div",{className:"".concat(T.default.right)},w.default.createElement(q,{extra:"".concat((0,V.sldComLanguage)("\u6d3b\u52a8\u65f6\u95f4\u4e0d\u53ef\u4e0e\u5176\u4ed6\u6d3b\u52a8\u91cd\u53e0")),style:{width:300}},f("activityTime",{initialValue:void 0!=i.startTime&&i.startTime?[(0,D.default)(i.startTime,V.dateTimeFormat),(0,D.default)(i.endTime,V.dateTimeFormat)]:"",rules:[{required:!0,message:"".concat((0,V.sldComLanguage)("\u8bf7\u9009\u62e9\u6d3b\u52a8\u65f6\u95f4"))}]})(w.default.createElement(F,{disabled:r,style:{width:400},placeholder:["".concat((0,V.sldComLanguage)("\u5f00\u59cb\u65f6\u95f4")),"".concat((0,V.sldComLanguage)("\u7ed3\u675f\u65f6\u95f4"))],showTime:{format:"HH:mm"},format:"YYYY-MM-DD HH:mm:00",getCalendarContainer:function(e){return e.parentNode}}))))),o.map(function(t,l){return w.default.createElement(w.Fragment,{key:l},(0,V.getSldEmptyH)(15),w.default.createElement("div",{className:"".concat(T.default.common_title_bg," ").concat(b.default.flex_row_between_center)},w.default.createElement("span",{className:"".concat(T.default.title)},"".concat((0,S.num_to_num)()[l+1]).concat((0,V.sldComLanguage)("\u7ea7\u4f18\u60e0"))),l>0&&w.default.createElement("div",{className:"".concat(T.default.del_ladder_pro),onClick:function(){return e.delPromotion(t.key)}},w.default.createElement(H.default,{fill:"#c8c8c8",width:18,height:18,type:"qingchu"}))),w.default.createElement("div",{className:"".concat(T.default.item," ").concat(b.default.flex_row_start_start)},w.default.createElement("div",{className:"".concat(T.default.left)},w.default.createElement("span",{style:{color:"red"}},"*"),(0,V.sldComLanguage)("\u4f18\u60e0\u95e8\u69db")),w.default.createElement("div",{className:"".concat(T.default.right)},w.default.createElement(q,{extra:"".concat((0,V.sldComLanguage)("\u4ee5\u4ef6\u4e3a\u5355\u4f4d\uff0c\u8bbe\u7f6e\u4f7f\u7528\u8be5\u6d3b\u52a8\u7684\u6700\u4f4e\u4ef6\u6570"))},f("fullValue_".concat(t.key),{initialValue:t.fullValue,rules:[{required:!0,message:"".concat((0,V.sldComLanguage)("\u8bf7\u8f93\u5165\u4f18\u60e0\u95e8\u69db"))}]})(w.default.createElement(s.default,{disabled:r,style:{width:400},min:1,max:9999999,precision:0}))))),w.default.createElement("div",{className:"".concat(T.default.item," ").concat(b.default.flex_row_start_start)},w.default.createElement("div",{className:"".concat(T.default.left)},w.default.createElement("span",{style:{color:"red"}},"*"),(0,V.sldComLanguage)("\u4f18\u60e0\u5185\u5bb9")),w.default.createElement("div",{className:"".concat(T.default.right," ").concat(b.default.flex_column_start_start)},w.default.createElement(q,{style:{width:300},extra:"".concat((0,V.sldComLanguage)("\u4f18\u60e0\u6298\u6263\uff0c\u6ee1\u8db3\u4f18\u60e0\u95e8\u69db\u540e\u53ef\u4ee5\u4eab\u53d7\u8be5\u4f18\u60e0\u6298\u6263\uff0c\u4f8b\u5982\uff1a\u8f93\u516590\u4ee3\u88689\u6298"))},w.default.createElement("span",{style:{marginRight:10}},(0,V.sldComLanguage)("\u6253")),f("minusValue_".concat(t.key),{initialValue:t.minusValue})(w.default.createElement(s.default,{disabled:r,style:{width:100},min:1,max:100,precision:0})),w.default.createElement("span",{style:{marginLeft:10}},(0,V.sldComLanguage)("\u6298"))),(0,V.getSldEmptyH)(10),w.default.createElement(q,{style:{width:300}},f("sendCouponIds_".concat(t.key),{initialValue:!(void 0==t.sel_voucher.couponId||!t.sel_voucher.couponId),valuePropName:"checked"})(w.default.createElement(d.default,{disabled:r,onChange:function(a){return e.handleGoodsOrVoucher("voucher",a,t)}},(0,V.sldComLanguage)("\u9001\u4f18\u60e0\u5238"))),void 0!=t.sel_voucher.couponId&&t.sel_voucher.couponId&&!r&&w.default.createElement("span",{className:"".concat(T.default.reset_sel),onClick:function(){return e.resetSel("voucher",t)}},(0,V.sldComLanguage)("\u91cd\u65b0\u9009\u62e9"))),void 0!=t.sel_voucher.couponId&&t.sel_voucher.couponId&&w.default.createElement("div",{className:"".concat(T.default.sel_goods," ").concat(b.default.flex_column_start_start)},w.default.createElement("div",{className:"".concat(b.default.flex_row_start_center)},w.default.createElement("span",{className:"".concat(T.default.sel_tip)},(0,V.sldComLanguage)("\u60a8\u5df2\u9009\u62e9\u5982\u4e0b\u4f18\u60e0\u5238\uff1a"))),w.default.createElement("div",{className:"".concat(T.default.goods_info," ").concat(b.default.flex_row_start_center)},w.default.createElement("div",{className:"".concat(T.default.left," ").concat(b.default.flex_row_center_center)},w.default.createElement("img",{src:a("3Tvx")})),w.default.createElement("div",{className:"".concat(b.default.flex_column_between_start)},w.default.createElement("span",{className:"".concat(T.default.goods_name)},(0,V.sldComLanguage)("\u4f18\u60e0\u5238")),w.default.createElement("span",{className:"".concat(T.default.goods_price)},t.sel_voucher.couponName)))),(0,V.getSldEmptyH)(10),w.default.createElement(q,{style:{width:700}},f("sendGoodsIds_".concat(t.key),{initialValue:!(void 0==t.sel_goods.goodsId||!t.sel_goods.goodsId),valuePropName:"checked"})(w.default.createElement(d.default,{disabled:r,onChange:function(a){return e.handleGoodsOrVoucher("goods",a,t)}},(0,V.sldComLanguage)("\u9001\u8d60\u54c1"))),void 0!=t.sel_goods.goodsId&&t.sel_goods.goodsId&&!r&&w.default.createElement("span",{className:"".concat(T.default.reset_sel),onClick:function(){return e.resetSel("goods",t)}},(0,V.sldComLanguage)("\u91cd\u65b0\u9009\u62e9"))),void 0!=t.sel_goods.goodsId&&t.sel_goods.goodsId&&w.default.createElement("div",{className:"".concat(T.default.sel_goods," ").concat(b.default.flex_column_start_start)},w.default.createElement("div",{className:"".concat(b.default.flex_row_start_center)},w.default.createElement("span",{className:"".concat(T.default.sel_tip)},(0,V.sldComLanguage)("\u60a8\u5df2\u9009\u62e9\u5982\u4e0b\u8d60\u54c1\uff1a"))),w.default.createElement("div",{className:"".concat(T.default.goods_info," ").concat(b.default.flex_row_start_center)},w.default.createElement("div",{className:"".concat(T.default.left," ").concat(b.default.flex_row_center_center)},w.default.createElement("img",{src:t.sel_goods.mainImgUrl||t.sel_goods.goodsImage})),w.default.createElement("div",{className:"".concat(b.default.flex_column_between_start)},w.default.createElement("span",{className:"".concat(T.default.goods_name)},(0,V.sldComLanguage)("\u8d60\u54c1")),w.default.createElement("span",{className:"".concat(T.default.goods_price)},t.sel_goods.goodsName)))))))}),o.length<5&&!r&&w.default.createElement("div",{className:"".concat(b.default.flex_row_start_center," ").concat(T.default.add_new)},(0,V.sldIconBtn)(function(){return e.addPromotion()},"".concat((0,V.sldComLanguage)("\u6dfb\u52a0\u4e0b\u7ea7\u4f18\u60e0")),7,7),w.default.createElement("span",{className:"".concat(T.default.add_new_tip)},(0,V.sldComLanguage)("\u63d0\u9192\uff1a\u6bcf\u7ea7\u4f18\u60e0\u4e0d\u53e0\u52a0\uff0c\u5982\uff1a\u6ee1\u8db3\u4e8c\u7ea7\u4f18\u60e0\u6761\u4ef6\u540e\u5219\u4e0d\u518d\u4eab\u6709\u4e00\u7ea7\u4f18\u60e0\uff0c\u6700\u591a\u652f\u63015\u7ea7\u4f18\u60e0~")))))),(0,V.getSldEmptyH)(15),w.default.createElement("div",{className:b.default.m_diy_bottom_wrap,style:{position:"fixed",left:this.props.global.collapsed?90:160}},w.default.createElement("div",{onClick:function(){return e.props.history.goBack()},className:b.default.add_goods_bottom_btn},(0,V.sldComLanguage)("\u8fd4\u56de")),!r&&w.default.createElement("div",{onClick:function(){return e.props.form.submit(e.handleSaveAllData)},className:"".concat(b.default.add_goods_bottom_btn," ").concat(b.default.add_goods_bottom_btn_sel)},(0,V.sldComLanguage)("\u4fdd\u5b58")))))),w.default.createElement(x.default,{link_type:u,seleSku:this.seleSku,sldHandleCancle:this.sldHandleLinkCancle,client:"mobile",params:{isVirtualGoods:1}}))}}]),t}(w.Component),L=k))||L)||L);t.default=M}}]);