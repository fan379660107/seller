(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[85],{UNZC:function(e,t,a){"use strict";var l=a("g09b"),o=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("T2oS");var d=l(a("W9HT"));a("sRBo");var n=l(a("kaz8"));a("giR+");var s=l(a("fyUT"));a("5NDa");var c=l(a("5rEg")),u=l(a("d6i3")),i=l(a("1l/V")),r=l(a("2Taf")),f=l(a("vZ4D")),m=l(a("l4Ni")),g=l(a("ujKo")),p=l(a("rlhR")),_=l(a("MhPg"));a("iQDF");var v=l(a("+eQT"));a("y8nQ");var h,y,E,C,w=l(a("Vl3Y")),N=a("MuoO"),L=o(a("q1tI")),k=a("k82f"),T=a("+n12"),I=l(a("hh8c")),b=l(a("JMh9")),x=l(a("kUTa")),S=l(a("wd/R")),V="",H=w.default.Item,D=v.default.RangePicker,F=(h=(0,N.connect)(function(e){var t=e.promotion,a=e.global;return{promotion:t,global:a}}),y=w.default.create(),h(E=y((C=function(e){function t(e){var a;return(0,r.default)(this,t),a=(0,m.default)(this,(0,g.default)(t).call(this,e)),a.get_detail=function(){var e=(0,i.default)(u.default.mark(function e(t){var l,o,d,n,s;return u.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:l=a.props.dispatch,o=a.state,d=o.detail,n=o.sel_goods,s=o.sel_voucher,l({type:"promotion/get_full_acm_detail",payload:{fullId:t},callback:function(){var e=(0,i.default)(u.default.mark(function e(t){return u.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:200==t.state?(d=t.data,null!=d.couponList&&void 0!=d.couponList.length&&d.couponList.length>0&&(s=d.couponList[0]),null!=d.giftList&&void 0!=d.giftList.length&&d.giftList.length>0&&(n=d.giftList[0]),a.setState({detail:d,sel_goods:n,sel_voucher:s})):(0,T.failTip)(t.msg);case 1:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleSelectRows=function(e,t){a.setState({selectedRows:e,selectedRowKeys:t})},a.handleSaveAllData=function(){var e=a.props.dispatch,t=a.state,l=t.query,o=t.sel_goods,d=t.sel_voucher;a.props.form.validateFieldsAndScroll(function(t,a){if(!t){if(a.activityTime&&(a.startTime=a.activityTime[0]?a.activityTime[0].format(T.dateTimeFormat):"",a.endTime=a.activityTime[1]?a.activityTime[1].format(T.dateTimeFormat):"",delete a.activityTime),Date.parse(a.startTime)>Date.parse(a.endTime))return(0,T.failTip)("".concat((0,T.sldComLanguage)("\u6d3b\u52a8\u5f00\u59cb\u65f6\u95f4\u5fc5\u987b\u5c0f\u4e8e\u7ed3\u675f\u65f6\u95f4"))),!1;if(a.sendCouponIds=void 0!=d.couponId&&d.couponId>0?d.couponId:"",a.sendGoodsIds=void 0!=o.goodsId&&o.goodsId>0?o.goodsId:"",!(1*a.minusValue||a.sendCouponIds||a.sendGoodsIds))return(0,T.failTip)("\u8bf7\u8bbe\u7f6e\u4f18\u60e0\u5185\u5bb9\uff5e"),!1;if(a.minusValue>=a.fullValue)return void(0,T.failTip)("\u4f18\u60e0\u5185\u5bb9\u91d1\u989d\u5fc5\u987b\u5c0f\u4e8e\u4f18\u60e0\u95e8\u69db\u91d1\u989d");V.setState({loading:!0});var n="";void 0!=l.id&&l.id>0&&"edit"==l.tar?(a.fullId=l.id,n="promotion/edit_full_acm"):n="promotion/add_full_acm",e({type:n,payload:a,callback:function(e){V.setState({loading:!1}),200==e.state?((0,T.sucTip)(e.msg),setTimeout(function(){V.props.history.goBack()},500)):(0,T.failTip)(e.msg)}})}})},a.handleVoucher=function(e){e.target.checked?a.setState({link_type:"voucher"}):a.setState({sel_voucher:{}})},a.handleGoods=function(e){e.target.checked?a.setState({link_type:"goods"}):a.setState({sel_goods:{}})},a.resetSel=function(e){a.setState({link_type:e})},a.sldHandleLinkCancle=function(){var e=a.state.link_type;"goods"==e?a.props.form.resetFields(["sendGoodsIds"]):"voucher"==e&&a.props.form.resetFields(["sendCouponIds"]),a.setState({link_type:""})},a.seleSku=function(e){var t=a.state,l=t.link_type,o=t.sel_goods,d=t.sel_voucher;"goods"==l?o=e:"voucher"==l&&(d=e),a.setState({link_type:"",sel_goods:o,sel_voucher:d})},V=(0,p.default)(a),a.state={sel_goods:{},sel_voucher:{},link_type:"",loading:!1,query:e.location.query,selectedRows:[],selectedRowKeys:[],detail:{},viewFlag:void 0!=e.location.query.tar&&"view"==e.location.query.tar},a}return(0,_.default)(t,e),(0,f.default)(t,[{key:"componentDidMount",value:function(){var e=this.state.query;void 0!=e.id&&e.id>0&&this.get_detail(e.id),this.props.dispatch({type:"global/getLayoutCollapsed"})}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this,t=this.state,l=t.loading,o=t.detail,u=t.link_type,i=t.sel_goods,r=t.sel_voucher,f=t.viewFlag,m=this.props.form.getFieldDecorator;return L.default.createElement("div",{className:"".concat(b.default.full_activity," ").concat(I.default.common_page," ").concat(I.default.com_flex_column),style:{position:"relative"}},(0,T.sldLlineRtextAddGoodsAddMargin)("#69A2F2","".concat((0,T.sldComLanguage)("\u6ee1\u51cf\u6d3b\u52a8")),0,0,10),(0,T.getSldHorLine)(1),L.default.createElement(d.default,{spinning:l},L.default.createElement(w.default,{layout:"inline"},L.default.createElement(k.Scrollbars,{autoHeight:!0,autoHeightMin:100,autoHeightMax:document.body.clientHeight-160},L.default.createElement("div",{className:"".concat(I.default.goods_sku_tab," ").concat(I.default.add_goods_wrap)},L.default.createElement("div",null,(0,T.getSldEmptyH)(10),(0,T.sldCommonTitleByBg)("".concat((0,T.sldComLanguage)("\u6d3b\u52a8\u57fa\u672c\u4fe1\u606f"))),L.default.createElement("div",{className:"".concat(b.default.full_acm_activity," ").concat(I.default.flex_column_start_start)},L.default.createElement("div",{className:"".concat(b.default.item," ").concat(I.default.flex_row_start_start)},L.default.createElement("div",{className:"".concat(b.default.left)},L.default.createElement("span",{style:{color:"red"}},"*"),(0,T.sldComLanguage)("\u6d3b\u52a8\u540d\u79f0")),L.default.createElement("div",{className:"".concat(b.default.right)},L.default.createElement(H,{extra:"".concat((0,T.sldComLanguage)("\u6700\u591a\u8f93\u516520\u4e2a\u5b57")),style:{width:300}},m("fullName",{initialValue:o.fullName,rules:[{required:!0,whitespace:!0,message:"".concat((0,T.sldComLanguage)("\u8bf7\u8f93\u5165\u6d3b\u52a8\u540d\u79f0"))}]})(L.default.createElement(c.default,{maxLength:20,disabled:f,style:{width:400},placeholder:"".concat((0,T.sldComLanguage)("\u8bf7\u8f93\u5165\u6d3b\u52a8\u540d\u79f0"))}))))),L.default.createElement("div",{className:"".concat(b.default.item," ").concat(I.default.flex_row_start_start)},L.default.createElement("div",{className:"".concat(b.default.left)},L.default.createElement("span",{style:{color:"red"}},"*"),(0,T.sldComLanguage)("\u6d3b\u52a8\u65f6\u95f4")),L.default.createElement("div",{className:"".concat(b.default.right)},L.default.createElement(H,{extra:"".concat((0,T.sldComLanguage)("\u6d3b\u52a8\u65f6\u95f4\u4e0d\u53ef\u4e0e\u5176\u4ed6\u6d3b\u52a8\u91cd\u53e0")),style:{width:300}},m("activityTime",{initialValue:void 0!=o.startTime&&o.startTime?[(0,S.default)(o.startTime,T.dateTimeFormat),(0,S.default)(o.endTime,T.dateTimeFormat)]:"",rules:[{required:!0,message:"".concat((0,T.sldComLanguage)("\u8bf7\u9009\u62e9\u6d3b\u52a8\u65f6\u95f4"))}]})(L.default.createElement(D,{disabled:f,disabledDate:function(e){return e<(0,S.default)().startOf("day")},style:{width:400},placeholder:["".concat((0,T.sldComLanguage)("\u5f00\u59cb\u65f6\u95f4")),"".concat((0,T.sldComLanguage)("\u7ed3\u675f\u65f6\u95f4"))],showTime:{format:"HH:mm"},format:"YYYY-MM-DD HH:mm:00",getCalendarContainer:function(e){return e.parentNode}}))))),L.default.createElement("div",{className:"".concat(b.default.item," ").concat(I.default.flex_row_start_start)},L.default.createElement("div",{className:"".concat(b.default.left)},L.default.createElement("span",{style:{color:"red"}},"*"),(0,T.sldComLanguage)("\u4f18\u60e0\u95e8\u69db")),L.default.createElement("div",{className:"".concat(b.default.right)},L.default.createElement(H,{extra:"".concat((0,T.sldComLanguage)("\u4ee5\u5143\u4e3a\u5355\u4f4d\uff0c\u8bbe\u7f6e\u4f7f\u7528\u8be5\u6d3b\u52a8\u7684\u6700\u4f4e\u91d1\u989d"))},m("fullValue",{initialValue:o.fullValue,rules:[{required:!0,message:"".concat((0,T.sldComLanguage)("\u8bf7\u8f93\u5165\u4f18\u60e0\u95e8\u69db"))}]})(L.default.createElement(s.default,{disabled:f,style:{width:145},min:1,max:9999999,precision:2}))))),L.default.createElement("div",{className:"".concat(b.default.item," ").concat(I.default.flex_row_start_start)},L.default.createElement("div",{className:"".concat(b.default.left)},L.default.createElement("span",{style:{color:"red"}},"*"),(0,T.sldComLanguage)("\u4f18\u60e0\u5185\u5bb9")),L.default.createElement("div",{className:"".concat(b.default.right," ").concat(I.default.flex_column_start_start)},L.default.createElement(H,{style:{width:300},extra:"".concat((0,T.sldComLanguage)("\u4ee5\u5143\u4e3a\u5355\u4f4d\uff0c\u6ee1\u8db3\u4f18\u60e0\u95e8\u69db\u540e\u53ef\u4ee5\u4eab\u53d7\u4f18\u60e0\u7684\u91d1\u989d"))},L.default.createElement("span",{style:{marginRight:10}},(0,T.sldComLanguage)("\u51cf")),m("minusValue",{initialValue:o.minusValue})(L.default.createElement(s.default,{disabled:f,style:{width:100},min:0,max:o.fullValue-.01,precision:2})),L.default.createElement("span",{style:{marginLeft:10}},(0,T.sldComLanguage)("\u5143"),o.fullValue)),(0,T.getSldEmptyH)(10),L.default.createElement(H,{style:{width:300}},m("sendCouponIds",{initialValue:!(void 0==r.couponId||!r.couponId),valuePropName:"checked"})(L.default.createElement(n.default,{disabled:f,onChange:function(t){return e.handleVoucher(t)}},(0,T.sldComLanguage)("\u9001\u4f18\u60e0\u5238"))),void 0!=r.couponId&&r.couponId&&!f&&L.default.createElement("span",{className:"".concat(b.default.reset_sel),onClick:function(){return e.resetSel("voucher")}},(0,T.sldComLanguage)("\u91cd\u65b0\u9009\u62e9"))),void 0!=r.couponId&&r.couponId&&L.default.createElement("div",{className:"".concat(b.default.sel_goods," ").concat(I.default.flex_column_start_start)},L.default.createElement("div",{className:"".concat(I.default.flex_row_start_center)},L.default.createElement("span",{className:"".concat(b.default.sel_tip)},(0,T.sldComLanguage)("\u60a8\u5df2\u9009\u62e9\u5982\u4e0b\u4f18\u60e0\u5238\uff1a"))),L.default.createElement("div",{className:"".concat(b.default.goods_info," ").concat(I.default.flex_row_start_center)},L.default.createElement("div",{className:"".concat(b.default.left," ").concat(I.default.flex_row_center_center)},L.default.createElement("img",{src:a("3Tvx")})),L.default.createElement("div",{className:"".concat(I.default.flex_column_between_start)},L.default.createElement("span",{className:"".concat(b.default.goods_name)},(0,T.sldComLanguage)("\u4f18\u60e0\u5238")),L.default.createElement("span",{className:"".concat(b.default.goods_price)},r.couponName)))),(0,T.getSldEmptyH)(10),L.default.createElement(H,{style:{width:300}},m("sendGoodsIds",{initialValue:!(void 0==i.goodsId||!i.goodsId),valuePropName:"checked"})(L.default.createElement(n.default,{disabled:f,onChange:function(t){return e.handleGoods(t)}},(0,T.sldComLanguage)("\u9001\u8d60\u54c1"))),void 0!=i.goodsId&&i.goodsId&&!f&&L.default.createElement("span",{className:"".concat(b.default.reset_sel),onClick:function(){return e.resetSel("goods")}},(0,T.sldComLanguage)("\u91cd\u65b0\u9009\u62e9"))),void 0!=i.goodsId&&i.goodsId&&L.default.createElement("div",{className:"".concat(b.default.sel_goods," ").concat(I.default.flex_column_start_start)},L.default.createElement("div",{className:"".concat(I.default.flex_row_start_center)},L.default.createElement("span",{className:"".concat(b.default.sel_tip)},(0,T.sldComLanguage)("\u60a8\u5df2\u9009\u62e9\u5982\u4e0b\u8d60\u54c1\uff1a"))),L.default.createElement("div",{className:"".concat(b.default.goods_info," ").concat(I.default.flex_row_start_center)},L.default.createElement("div",{className:"".concat(b.default.left," ").concat(I.default.flex_row_center_center)},L.default.createElement("img",{src:i.mainImgUrl||i.goodsImage})),L.default.createElement("div",{className:"".concat(I.default.flex_column_between_start)},L.default.createElement("span",{className:"".concat(b.default.goods_name)},(0,T.sldComLanguage)("\u8d60\u54c1")),L.default.createElement("span",{className:"".concat(b.default.goods_price)},i.goodsName))))))))),(0,T.getSldEmptyH)(15),L.default.createElement("div",{className:I.default.m_diy_bottom_wrap,style:{position:"fixed",left:this.props.global.collapsed?90:160}},L.default.createElement("div",{onClick:function(){return e.props.history.goBack()},className:I.default.add_goods_bottom_btn},(0,T.sldComLanguage)("\u8fd4\u56de")),!f&&L.default.createElement("div",{onClick:function(){return e.props.form.submit(e.handleSaveAllData)},className:"".concat(I.default.add_goods_bottom_btn," ").concat(I.default.add_goods_bottom_btn_sel)},(0,T.sldComLanguage)("\u4fdd\u5b58")))))),L.default.createElement(x.default,{link_type:u,seleSku:this.seleSku,sldHandleCancle:this.sldHandleLinkCancle,client:"mobile",params:{isVirtualGoods:1}}))}}]),t}(L.Component),E=C))||E)||E);t.default=F}}]);